<%- include('../../template/_header') %>

    <div id="app">
        <%- include('../../template/_sidebar') %>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>Halaman Penjualan</h3>
                            <p class="text-subtitle text-muted">Berikut beberapa buku yang bisa dibeli</p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="/">Penjualan</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Keranjang</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>

                <section class="section">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Form Keranjang</h4>
                        </div>
                        <div class="card-content">
                            <div class="card-body" style="padding-top:0px;" >
                                <div class="col-md-12" style="margin-bottom:20px;">
                                    <form class="form form-horizontal" action="/cart" method="GET" id="cart_cari_buku">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="input-group mb-4">
                                                    <input type="text" class="form-control" placeholder="Cari buku..." name="cart">
                                                    <button class="btn btn-primary" type="submit" id="button-addon1">Button</button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="col-md-12">
                                    <form class="form form-horizontal" action="/api/cart" method="POST">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <label>Kasir</label>
                                                    </div>
                                                    <div class="col-md-8 form-group">
                                                        <input type="text" class="form-control" name="kasir" value="Hanas April" readonly>
                                                        <input type="hidden" name="id_kasir" value="62b9d38cfe879ae92c23b99f" readonly>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label>ISBN</label>
                                                    </div>
                                                    <div class="col-md-8 form-group">
                                                        <input type="text" class="form-control" name="isbn" value="<%=cart.isbn%>" readonly>
                                                        <input type="hidden" class="form-control" name="id_buku" value="<%=cart._id%>" readonly>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label>Nama Buku</label>
                                                    </div>
                                                    <div class="col-md-8 form-group">
                                                        <input type="text" class="form-control" name="name" value="<%=cart.name%>" readonly>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label>Kategori</label>
                                                    </div>
                                                    <div class="col-md-8 form-group">
                                                        <input type="text" class="form-control" name="kategori" value="<%=cart.kategori%>" readonly>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label>Harga</label>
                                                    </div>
                                                    <div class="col-md-8 form-group">
                                                        <input type="number" class="form-control" id="harga" name="harga" value="<%=cart.harga%>" readonly>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label>Jumlah Beli</label>
                                                    </div>
                                                    <div class="col-md-4 form-group">
                                                        <input type="number" class="form-control" id="jumlah" name="jumlah" placeholder="2">
                                                    </div>
                                                    <div class="col-md-4 form-group">
                                                        <input type="number" class="form-control" id="total" name="total" placeholder="20000">
                                                    </div>
                                                    <div class="col-md-4">
                                                    </div>
                                                    <div class="col-md-8">
                                                        <button type="submit" class="btn btn-primary me-1 mb-1">Submit</button>
                                                        <button type="reset"class="btn btn-light-secondary me-1 mb-1">Reset</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <img id="blah" src="http://<%= baseUrl %>/images/buku/<%=cart.picture%>" onerror="this.src='/images/your_image_here.jpg'"
                                                        style="height: 250px;
                                                        border-radius: 5px;
                                                        display: block;
                                                        margin-left: auto;
                                                        margin-right: auto;
                                                        width: 200px;
                                                        border: 2px solid darkgrey;"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        if(window.location.pathname == "/cart"){
            $ondelete = $("#delete-cart");
            $ondelete.click(function(){
                var id = $(this).attr("data-id")

                var request = {
                    "url" : `http://localhost:3000/api/cart/${id}`,
                    "method" : "DELETE"
                }

                if(confirm("Do you really want to delete this record?")){
                    $.ajax(request).done(function(response){
                        alert("Data Deleted Successfully!");
                        location.reload();
                    })
                }

            })
        }
        $( "#cart_cari_buku" ).submit(function( event ) {
            $("#blah").attr("src","http://<%= baseUrl %>/images/buku/<%=cart.picture%>");
        });

        $(document).ready(function()
        {
            function updatePrice()
            {
                var price = parseFloat($("#harga").val());
                var qty = parseFloat($("#jumlah").val());
                var total = price * qty;
                $("#total").val(total);
            }
            $(document).on("change, keyup", "#jumlah", updatePrice);
        });



        
    </script>
<%- include('../../template/_footer') %>